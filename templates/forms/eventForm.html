{{ define "forms/eventForm.html" }}

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Créer un événement</title>
  <link rel="icon" href="static/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://codepen.io/gymratpacks/pen/VKzBEp#0">
  <link href='https://fonts.googleapis.com/css?family=Nunito:400,300' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/static/formStyle.css">
</head>
<script text="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    const geomSelect = document.getElementById("event_map_object_geometry_type")
    const adresseInput = document.getElementById("event_map_object_geometry_address")
    const pointInput = document.getElementById("event_map_object_geometry_coordinates")
    geomSelect.value = "Adresse"
    pointInput.style.display = "none" 

    geomSelect.addEventListener("change", function () {
      if (geomSelect.value === "Adresse") {
        pointInput.style.display = "none"
        adresseInput.style.display = "block"
      } else if (geomSelect.value === "Point") {
        pointInput.style.display = "block"
        adresseInput.style.display = "none"
      }
    })

    adresseInput.addEventListener("change", function() {
      const adresses = getAdresses(adresseInput.value, (adresses) => {
        const selectedAddress = adresses[0]
        console.log(selectedAddress)
        adresseInput.value = selectedAddress.properties.nom
        const coords = selectedAddress.geometry.coordinates
        pointInput.value = coords[1] + ", " + coords[0]
      })
    })

    function getAdresses(address, cb) {
      fetch(`https://geoegl.msp.gouv.qc.ca/apis/icherche/geocode?type=adresses&limit=5&geometry=true&q=${address}`).then(response => {
        response.json().then(result => {
          cb(result.features)
        })
      })
    }
  })
</script>
<div class="row">
  <div class="col-md-12">
    <form action="/create-event" method="post" id="form-container" style="padding: 20px;">
      <fieldset>
        <legend><span class="number">1</span>Événement</legend>

        <label for="map_object_name">Nom:</label>
        <input type="text" placeholder="Nom" id="map_object_name" name="map_object_name" required>

        <label for="map_object_description">Description:</label>
        <textarea id="map_object_description" name="map_object_description" placeholder="Description...." tabindex="5"
          required></textarea>
      </fieldset>

      <fieldset>
        <legend><span class="number">2</span>Informations supplémentaires</legend>

        <label for="map_object_category">Catégorie:</label>
        <select id="map_object_category" name="map_object_category" required>
          <option value="" disabled selected>Sélectionner une catégorie</option>
          {{ range .CategoryKeys }}
          <option value="{{ . }}">{{ . }}</option>
          {{ end }}
        </select>

        <label for="danger_level">Niveau de danger:</label>
        <select id="danger_level" name="danger_level" required>
          <option value="" disabled selected>Sélectionner un niveau de danger</option>
          <option value="0">Élevé</option>
          <option value="1">Modéré</option>
          <option value="2">Faible</option>
        </select>

        <label for="urgency_type">Niveau d'urgence:</label>
        <select id="urgency_type" name="urgency_type" required>
          <option value="" disabled selected>Sélectionner un niveau d'urgence</option>
          <option value="0">Futur</option>
          <option value="1">Présent</option>
          <option value="2">Passé</option>
        </select>

        <label for="map_object_geometry">Coordonnées:</label>
        <select id="event_map_object_geometry_type">
          <option selected="selected" value="Adresse">Adresse</option>
          <option value="Point">Point</option>
        </select>

        <input type="hidden" value="Point" name="map_object_geometry_type"/>
        <input type="text" placeholder="Coordonnées (format: 1.0, 2.0)" id="event_map_object_geometry_coordinates" name="map_object_geometry_coordinates" required>

        <input type="text" autocomplete="off" placeholder="Adresse" id="event_map_object_geometry_address">

        <label for="map_object_tags">Tags:</label>
        <input type="text" id="map_object_tags" placeholder="format: tag1, tag2, ..." name="map_object_tags">

      </fieldset>

      <button class="w3-button w3-teal w3-margin-top" type="submit">Soumettre</button>

    </form>
  </div>
</div>
{{ end }}